<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<script
	src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/popper.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<!-- 헤더링크 -->
<th:block th:replace="~{fragments/header_link :: header_link}" />

<body>
	<!-- Header Section Begin -->
	<th:block th:replace="~{fragments/header :: header}" />
	<!-- Header End -->
	<div class="container">
		<form id="form1" class="form-horizontal" method="post"
			th:action="@{/volunteer/apply}">
			<!-- 제목 입력란 -->
			<div class="form-group row">
				<label for="title" class="col-sm-12 col-form-label">제목</label>
				<div class="col-sm-12">
					<input type="text" class="form-control" id="title" name="title"
						th:value="${detail.title}" placeholder="제목을 입력해 주세요." readonly>
				</div>
			</div>

			<!-- 날짜 및 시간, 모집 인원, 보호소 -->
			<div class="form-group row">
				<div class="col-4">
					<div class="form-group row">
						<label for="date_time" class="col-sm-12 col-form-label">날짜
							및 시간</label>
						<div class="col-sm-12">
							<input type="date" class="form-control" id="volDate"
								name="volDate" th:value="${detail.vol_date}" readonly>
						</div>
					</div>
					<div class="form-group row">
						<div class="col-6" style="padding: 0;">
							<label for="participants" class="col-sm-12 col-form-label">모집인원</label>
							<div class="col-sm-12">
								<input type="number" class="form-control" id="recruitCount"
									name="recruitCount" th:value="${detail.recruit_count}"
									placeholder="모집 인원을 입력해 주세요." readonly>
							</div>										
						</div>
						<div class="col-6" style="padding: 0;">
							<label for="participants" class="col-sm-12 col-form-label">신청인원</label>
							<div class="col-sm-12">
								<input type="number" class="form-control" id="registCount"
									name="registCount" th:value="${registCount}"
									placeholder="신청 인원 수 입니다." readonly>
							</div>						
						</div>						
					</div>
					<div class="form-group row">
						<label for="location" class="col-sm-12 col-form-label">보호소</label>
						<div class="col-sm-12">
							<input type="text" class="form-control" id="shelterName"
								name="shelterName" th:value="${detail.shelter_name}"
								placeholder="보호소를 입력해 주세요." readonly>
						</div>
					</div>
				</div>
				<div class="col-8">
					<div class="form-group row">
						<label for="details" class="col-sm-12 col-form-label">세부
							내용 작성란</label>
						<div class="col-sm-12">
							<textarea class="form-control" id="bodyText" name="bodyText"
								rows="10" th:text="${detail.body_text}"
								placeholder="세부 내용을 작성해 주세요." readonly></textarea>
						</div>
					</div>
				</div>
			</div>
			<!-- noticeId, id를 둘다 쓰지 않으면 db값이 url에 계속 담김 -->
			<input type="hidden" name="noticeId" th:value="${detail.vol_event_post_idx}"> 
			<input type="hidden" name="id" th:value="${detail.vol_event_post_idx}">
			<button type="submit" class="btn btn-secondary col-12 mb-3">봉사 신청</button>
			<button type="button" class="btn btn-secondary col-12" id="bt_list">목록으로 돌아가기</button>
		</form>
	</div>
</body>
</html>
<script type="text/javascript">
  function list(){
    $("#form1").attr({
      action:"/volunteer/list",
      method:"get"
    });
    $("#form1").submit();
  }

  $(function(){
    $("#bt_list").click(function(){
      list();      
    });

    $("#applyBtn").click(function(){
        const formData = {
          title: $("#title").val(),
          volDate: $("#volDate").val(),
          noticeId: $("input[name='noticeId']").val(),
          id: $("input[name='id']").val()
        };
        
        $.ajax({
          type: "POST",
          url: "/volunteer/apply",
          data: formData,
          success: function() {
            alert("신청 완료");
            $("#applyBtn").text("신청 취소").removeClass("btn-primary").addClass("btn-danger").off("click").click(cancelApplication);
          },
          error: function() {
            alert("신청에 실패했습니다.");
          }
        });
      });

      function cancelApplication() {
        const applicationId = $("input[name='id']").val();
        
        $.ajax({
          type: "POST",
          url: "/volunteer/cancel",
          data: { applicationId: applicationId },
          success: function() {
            alert("신청 취소 완료");
            //https://www.w3schools.com/jquery/jquery_css_classes.asp 
            // 이어 붙이기 가능
            $("#applyBtn").text("봉사 신청").removeClass("btn-danger").addClass("btn-primary").off("click").click(applyApplication);
          },
          error: function() {
            alert("신청 취소에 실패했습니다.");
          }
        });
      }
      
	// vol_date -> volDate 변경 
      function applyApplication() {
        const formData = {
          title: $("#title").val(),
          volDate: $("#volDate").val(),
          noticeId: $("input[name='noticeId']").val(),
          id: $("input[name='id']").val()
        };
        
        $.ajax({
          type: "POST",
          url: "/volunteer/apply",
          data: formData,
          success: function() {
            alert("신청 완료");
            $("#applyBtn").text("신청 취소").removeClass("btn-primary").addClass("btn-danger").off("click").click(cancelApplication);
          },
          error: function() {
            alert("신청에 실패했습니다.");
          }
        });
      }

      $("#applyBtn").click(applyApplication);
    });
</script>